  
name: SwiftLint Autocorrect

on: [pull_request]

jobs:
  build:

    runs-on: macOS-latest
    
    steps:
    - uses: actions/checkout@v1
    - name: install swiftlint
      run: brew install swiftlint
    - name: swiftlint
      run: swiftlint autocorrect --format
    - name: Setup git
      env:
        ACCESS_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git config --local user.name "Github Action"
        git config --local user.email "action@github.com"
    - name: Git commit
      run: |
        git checkout -b hoge
        git add -A
        
        DIFF=`git diff --cached --numstat | wc -l`
          if [ $DIFF -eq 0 ]; then
          # ファイルの変更がなければjobを正常終了する
            exit 0
          fi
        git commit -am 'swiftlint autocorrect'
        
    - name: Git push
      env: 
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git remote set-url origin https://${GITHUB_ACTOR}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git
        git push origin hoge
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v1.5.4-multi
      env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PULL_REQUEST_TITLE: '[CI] swiftlint autocorrect'
